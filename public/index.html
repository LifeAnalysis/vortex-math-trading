<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vortex Trading Backtester</title>
    <link rel="stylesheet" href="/src/ui/styles.css">
    <!-- TradingView Lightweight Charts (CDN) - Version 5 -->
    <script src="https://unpkg.com/lightweight-charts@5.0.8/dist/lightweight-charts.standalone.production.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üåÄ Vortex Trading Backtester</h1>
            <p class="subtitle">Mathematical Pattern Backtesting Tool</p>
        </header>

        <!-- Strategy Information -->
        <section class="strategy-info">
            <h3>About this Strategy</h3>
            <p>
                This experimental system applies vortex mathematics to market prices:
                it computes digital roots (mod 9) and uses the classic doubling cycle
                (1‚Üí2‚Üí4‚Üí8‚Üí7‚Üí5) for sequencing. Default rules are: BUY on 1 (cycle start),
                SELL on 5 (cycle peak), HOLD on 9 (balance). Optional Tesla 3-6-9 filter
                biases entries/exits and the doubling sequence filter constrains signals
                to the canonical cycle. Include realistic assumptions via fees and slippage.
            </p>
            <ul>
                <li><strong>Digital Root:</strong> price reduced via modulo 9 arithmetic</li>
                <li><strong>Doubling Sequence:</strong> 1 ‚Üí 2 ‚Üí 4 ‚Üí 8 ‚Üí 7 ‚Üí 5</li>
                <li><strong>Tesla Filter:</strong> 3 (buy bias), 6 (sell bias), 9 (hold)</li>
                <li><strong>Risk:</strong> stop loss / take profit / position size</li>
                <li><strong>Costs:</strong> per-side fees and slippage (bps)</li>
            </ul>
        </section>

        <main>
            <!-- Backtesting Configuration -->
            <section class="config-section">
                <h2>üìä Backtest Configuration</h2>
                <div class="config-grid">
                    <div class="config-group">
                        <label for="buy-signal">Buy Signal (Digital Root):</label>
                        <select id="buy-signal">
                            <option value="1" selected>1 - Start</option>
                            <option value="2">2 - Growth</option>
                            <option value="3">3 - Tesla Positive</option>
                            <option value="4">4 - Structure</option>
                            <option value="5">5 - Peak</option>
                            <option value="6">6 - Tesla Negative</option>
                            <option value="7">7 - Decline</option>
                            <option value="8">8 - Power</option>
                            <option value="9">9 - Balance</option>
                        </select>
                    </div>
                    
                    <div class="config-group">
                        <label for="hold-signal">Hold Signal (Digital Root):</label>
                        <select id="hold-signal">
                            <option value="1">1 - Start</option>
                            <option value="2">2 - Growth</option>
                            <option value="3">3 - Tesla Positive</option>
                            <option value="4">4 - Structure</option>
                            <option value="5">5 - Peak</option>
                            <option value="6">6 - Tesla Negative</option>
                            <option value="7">7 - Decline</option>
                            <option value="8">8 - Power</option>
                            <option value="9" selected>9 - Balance</option>
                        </select>
                    </div>

                    <div class="config-group">
                        <label for="sell-signal">Sell Signal (Digital Root):</label>
                        <select id="sell-signal">
                            <option value="1">1 - Start</option>
                            <option value="2">2 - Growth</option>
                            <option value="3">3 - Tesla Positive</option>
                            <option value="4">4 - Structure</option>
                            <option value="5" selected>5 - Peak</option>
                            <option value="6">6 - Tesla Negative</option>
                            <option value="7">7 - Decline</option>
                            <option value="8">8 - Power</option>
                            <option value="9">9 - Balance</option>
                        </select>
                    </div>
                    
                    <div class="config-group">
                        <label for="initial-capital">Initial Capital ($):</label>
                        <input type="number" id="initial-capital" value="10000" min="1000" max="1000000" step="1000">
                    </div>
                    
                    <div class="config-group">
                        <label>Filters</label>
                        <div class="inline">
                            <label><input type="checkbox" id="tesla-filter" checked> Tesla 3-6-9</label>
                            <label><input type="checkbox" id="sequence-filter" checked> Doubling Sequence</label>
                        </div>
                    </div>

                    <div class="config-group">
                        <label for="position-size">Position Size (0.1 - 1.0)</label>
                        <input type="number" id="position-size" value="1.0" min="0.1" max="1.0" step="0.1">
                    </div>

                    <div class="config-group">
                        <label for="stop-loss">Stop Loss %</label>
                        <input type="number" id="stop-loss" value="10" min="0" max="100" step="0.5">
                    </div>

                    <div class="config-group">
                        <label for="take-profit">Take Profit %</label>
                        <input type="number" id="take-profit" value="20" min="0" max="100" step="0.5">
                    </div>



                    <div class="config-group">
                        <label for="date-range">Test Period:</label>
                        <div class="date-inputs">
                            <input type="date" id="start-date" value="2020-01-01">
                            <input type="date" id="end-date" value="2023-12-31">
                        </div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button id="run-backtest" class="btn-primary">üöÄ Run Backtest</button>
                    <button id="reset-config" class="btn-secondary">üîÑ Reset</button>
                </div>


            </section>

            <!-- Results Section -->
            <section class="results-section" id="results-section" style="display: none;">
                <h2>üìà Backtest Results</h2>
                
                <!-- Performance Metrics -->
                <div class="metrics-grid">
                    <div class="metric-card">
                        <h3>Total Return</h3>
                        <div class="metric-value" id="total-return">‚Äî</div>
                    </div>
                    <div class="metric-card">
                        <h3>Win Rate</h3>
                        <div class="metric-value" id="win-rate">‚Äî</div>
                    </div>
                    <div class="metric-card">
                        <h3>Total Trades</h3>
                        <div class="metric-value" id="total-trades">‚Äî</div>
                    </div>
                    <div class="metric-card">
                        <h3>Max Drawdown</h3>
                        <div class="metric-value negative" id="max-drawdown">‚Äî</div>
                    </div>
                    <div class="metric-card">
                        <h3>Sharpe Ratio</h3>
                        <div class="metric-value" id="sharpe-ratio">‚Äî</div>
                    </div>
                    <div class="metric-card">
                        <h3>Final Capital</h3>
                        <div class="metric-value" id="final-capital">‚Äî</div>
                    </div>
                    <div class="metric-card comparison-card">
                        <h3>Buy & Hold</h3>
                        <div class="metric-value" id="buy-hold-return">‚Äî</div>
                        <div class="metric-subtitle" id="buy-hold-capital">‚Äî</div>
                    </div>
                    <div class="metric-card comparison-card">
                        <h3>Strategy vs Buy & Hold</h3>
                        <div class="metric-value" id="strategy-outperformance">‚Äî</div>
                    </div>
                </div>
                
                <!-- Navigation Tabs -->
                <div class="tabs">
                    <button class="tab active" data-tab="chart">üìä Chart & Signals</button>
                    <button class="tab" data-tab="trades">üìã Trade History</button>
                    <button class="tab" data-tab="analysis">üîç Pattern Analysis</button>
                </div>
                
                <!-- Tab Content -->
                <div class="tab-content">
                    <div id="chart-tab" class="tab-panel active">
                        <div id="price-chart-container">
                            <!-- TradingView Chart Container -->
                            <div id="tradingview-chart" style="height: 500px; width: 100%;"></div>
                            <div id="chart-status">Chart will display after running backtest</div>
                        </div>
                        
                        <div class="signal-legend">
                            <h4>Vortex Trading Signals</h4>
                            <div class="legend-grid">
                                <div class="legend-item">
                                    <span style="background: #00ff88; color: #000; padding: 4px 8px; border-radius: 50%; font-weight: bold; display: inline-block; width: 20px; height: 20px; text-align: center; line-height: 12px; box-shadow: 0 0 10px rgba(0,255,136,0.4);">1</span> 
                                    Buy Signal (Cycle Start)
                                </div>
                                <div class="legend-item">
                                    <span style="background: #ff4757; color: white; padding: 4px 8px; border-radius: 50%; font-weight: bold; display: inline-block; width: 20px; height: 20px; text-align: center; line-height: 12px; box-shadow: 0 0 10px rgba(255,71,87,0.4);">5</span> 
                                    Sell Signal (Cycle Peak)
                                </div>
                                <div class="legend-item">
                                    <span style="color: #00ff88; font-weight: bold;">‚ñ¨</span><span style="color: #ff4757; font-weight: bold;">‚ñ¨</span> 
                                    BTC Price Candlesticks
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="trades-tab" class="tab-panel">
                        <div class="trades-container">
                            <div id="trades-table">No trades to display - run backtest first</div>
                        </div>
                    </div>
                    
                    <div id="analysis-tab" class="tab-panel">
                        <div class="analysis-grid">
                            <div class="analysis-card">
                                <h4>Digital Root Distribution</h4>
                                <div id="root-distribution">No data available</div>
                            </div>
                            <div class="analysis-card">
                                <h4>Strategy Performance</h4>
                                <div id="strategy-performance">Run backtest to see analysis</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- App scripts (ordered) -->
    <script src="/src/core/vortex-math.js"></script>
    <script src="/src/data/coingecko-api.js"></script>
    <script src="/src/data/data-processor.js"></script>
    <script src="/src/ui/charts.js"></script>
    <script src="/src/strategies/vortex-strategy.js"></script>
    <script src="/src/ui/app.js"></script>
</body>
</html>