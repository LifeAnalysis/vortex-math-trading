#!/usr/bin/env node

/**
 * Extend Solana dataset with additional CoinGecko data until August 11, 2025
 * Adds 213 new data points from January 12, 2025 to August 11, 2025
 */

const fs = require('fs');
const path = require('path');

// New CoinGecko data points (Jan 12, 2025 to Aug 11, 2025)
const newDataPoints = [
  [1735689600000, 189.45168366761857],
  [1735776000000, 193.64679144177083],
  [1735862400000, 207.87862676897498],
  [1735948800000, 217.647289485303],
  [1736035200000, 216.68364826265568],
  [1736121600000, 213.44823541657385],
  [1736208000000, 218.4209767110049],
  [1736294400000, 202.492545725036],
  [1736380800000, 197.45206766283226],
  [1736467200000, 185.0111350868991],
  [1736553600000, 187.8201167474825],
  [1736640000000, 188.0632507646954],
  [1736726400000, 188.39194289058088],
  [1736812800000, 183.11428850097792],
  [1736899200000, 187.70452520232413],
  [1736985600000, 205.75854800567018],
  [1737072000000, 211.23399374041628],
  [1737158400000, 219.77905400813702],
  [1737244800000, 262.5615764589647],
  [1737331200000, 251.97488550305266],
  [1737417600000, 242.47150410221352],
  [1737504000000, 250.3984908388754],
  [1737590400000, 256.1143343782641],
  [1737676800000, 253.49503131499628],
  [1737763200000, 253.62637885441316],
  [1737849600000, 257.0742996969564],
  [1737936000000, 241.06731630326192],
  [1738022400000, 234.97914713600687],
  [1738108800000, 226.88945614638288],
  [1738195200000, 228.6145425527223],
  [1738281600000, 239.04719726337646],
  [1738368000000, 231.50782299297455],
  [1738454400000, 214.46366422580272],
  [1738540800000, 202.32492853599265],
  [1738627200000, 215.95147229807475],
  [1738713600000, 207.42406393975517],
  [1738800000000, 196.21787573260255],
  [1738886400000, 189.38932513491977],
  [1738972800000, 192.2709679394336],
  [1739059200000, 199.70939394589394],
  [1739145600000, 200.44634668796408],
  [1739232000000, 200.0458466193684],
  [1739318400000, 197.92915264031842],
  [1739404800000, 196.60301392852935],
  [1739491200000, 194.2631701900725],
  [1739577600000, 199.65011966060425],
  [1739664000000, 194.4254509858272],
  [1739750400000, 188.165584495931],
  [1739836800000, 177.91997195388805],
  [1739923200000, 169.10718217289786],
  [1740009600000, 169.26443436615673],
  [1740096000000, 176.02074183930708],
  [1740182400000, 169.00123201382314],
  [1740268800000, 172.21280391506767],
  [1740355200000, 168.09302650361454],
  [1740441600000, 141.16593031186233],
  [1740528000000, 144.3563354963687],
  [1740614400000, 134.6628545613439],
  [1740700800000, 137.60648163669737],
  [1740787200000, 148.17466304440643],
  [1740873600000, 143.4002225931321],
  [1740960000000, 178.17413183106032],
  [1741046400000, 142.5141267061424],
  [1741132800000, 145.06190940041165],
  [1741219200000, 146.1815871653316],
  [1741305600000, 143.45134750836067],
  [1741392000000, 139.1826626278542],
  [1741478400000, 136.88210638232243],
  [1741564800000, 126.63426805755283],
  [1741651200000, 118.78644366084116],
  [1741737600000, 125.4287680235315],
  [1741824000000, 126.56536487567297],
  [1741910400000, 123.23770752728635],
  [1741996800000, 133.5545345544276],
  [1742083200000, 135.83808085318316],
  [1742169600000, 126.16514527624146],
  [1742256000000, 128.27980954134415],
  [1742342400000, 125.34406014353017],
  [1742428800000, 135.62276169425357],
  [1742515200000, 127.67626424914864],
  [1742601600000, 128.23973822410704],
  [1742688000000, 128.39187391771924],
  [1742774400000, 132.10106868785385],
  [1742860800000, 140.57936877383233],
  [1742947200000, 143.93305133739045],
  [1743033600000, 137.09334253160864],
  [1743120000000, 138.37897933357002],
  [1743206400000, 129.44621681849003],
  [1743292800000, 124.50189658068513],
  [1743379200000, 124.5806499329744],
  [1743465600000, 124.86617842858315],
  [1743552000000, 126.80693682115113],
  [1743638400000, 118.08550586157003],
  [1743724800000, 117.1929518844708],
  [1743811200000, 122.71307466195722],
  [1743897600000, 120.16838205477265],
  [1743984000000, 105.76515013740064],
  [1744070400000, 106.7967654056102],
  [1744156800000, 105.48654682895575],
  [1744243200000, 118.96288063114291],
  [1744329600000, 112.88616853404648],
  [1744416000000, 121.39249540173658],
  [1744502400000, 132.15438529607428],
  [1744588800000, 128.2347432835372],
  [1744675200000, 129.42181202590046],
  [1744761600000, 126.3038818388089],
  [1744848000000, 131.4761427933663],
  [1744934400000, 134.6151648808524],
  [1745020800000, 133.9760882871713],
  [1745107200000, 139.64248014652355],
  [1745193600000, 137.6315829179827],
  [1745280000000, 136.3303974884886],
  [1745366400000, 148.80397504642707],
  [1745452800000, 150.9999108899842],
  [1745539200000, 152.3299363576059],
  [1745625600000, 150.92008896105446],
  [1745712000000, 149.14633083954075],
  [1745798400000, 148.2466719511348],
  [1745884800000, 147.99083303267335],
  [1745971200000, 146.49305755147196],
  [1746057600000, 147.73348327834748],
  [1746144000000, 150.76046702861854],
  [1746230400000, 147.97213909446802],
  [1746316800000, 146.79754814764868],
  [1746403200000, 143.9823040324787],
  [1746489600000, 146.81070557078957],
  [1746576000000, 146.90938773866714],
  [1746662400000, 147.20059726659957],
  [1746748800000, 163.41627317514832],
  [1746835200000, 172.6970765026263],
  [1746921600000, 177.3428319704922],
  [1747008000000, 172.85779222329435],
  [1747094400000, 174.41950190990173],
  [1747180800000, 184.05379777179434],
  [1747267200000, 176.45507175799847],
  [1747353600000, 168.75269732863256],
  [1747440000000, 167.76812404954248],
  [1747526400000, 165.9394166641985],
  [1747612800000, 171.54067495745267],
  [1747699200000, 166.7148813421899],
  [1747785600000, 168.38572912424627],
  [1747872000000, 173.96771434765478],
  [1747958400000, 179.57884486750282],
  [1748044800000, 174.43566967519817],
  [1748131200000, 175.9976176396849],
  [1748217600000, 175.13203918726265],
  [1748304000000, 174.71672204451494],
  [1748390400000, 176.57784495904014],
  [1748476800000, 172.12073410994773],
  [1748563200000, 166.83894593726552],
  [1748649600000, 156.51262963204462],
  [1748736000000, 156.86968538083693],
  [1748822400000, 157.63092185153255],
  [1748908800000, 156.97126157615844],
  [1748995200000, 155.57609294535118],
  [1749081600000, 153.52933334658826],
  [1749168000000, 144.54778524030908],
  [1749254400000, 148.27289869882955],
  [1749340800000, 150.07536034230216],
  [1749427200000, 152.50446458828966],
  [1749513600000, 161.15980951265985],
  [1749600000000, 164.9644225697288],
  [1749686400000, 161.01986639557893],
  [1749772800000, 152.6604566097001],
  [1749859200000, 148.53042859104298],
  [1749945600000, 144.75154594223267],
  [1750032000000, 152.684889859998],
  [1750118400000, 151.43554856186984],
  [1750204800000, 147.99188434299543],
  [1750291200000, 146.27697674399295],
  [1750377600000, 147.09924520457085],
  [1750464000000, 140.04009054961782],
  [1750550400000, 133.71000196412658],
  [1750636800000, 131.8134744866569],
  [1750723200000, 144.7815680115998],
  [1750809600000, 145.8019507474219],
  [1750896000000, 143.37011953879949],
  [1750982400000, 138.97799072607012],
  [1751068800000, 142.12675809713753],
  [1751155200000, 150.7812372563586],
  [1751241600000, 153.31879559308874],
  [1751328000000, 154.9374500694811],
  [1751414400000, 146.84115991278014],
  [1751500800000, 152.1680329188485],
  [1751587200000, 152.28063806980848],
  [1751673600000, 147.76302956048175],
  [1751760000000, 147.60067170952217],
  [1751846400000, 151.92103968743746],
  [1751932800000, 148.79005045485957],
  [1752019200000, 151.83083400485827],
  [1752105600000, 157.20772193763892],
  [1752192000000, 163.85821380442644],
  [1752278400000, 162.75319398002793],
  [1752364800000, 160.46917812212587],
  [1752451200000, 161.2426294578984],
  [1752537600000, 162.28222240485653],
  [1752624000000, 163.96583057213138],
  [1752710400000, 173.8289647474319],
  [1752796800000, 176.0976453468298],
  [1752883200000, 177.36979874415755],
  [1752969600000, 176.91082733883786],
  [1753056000000, 180.99223128612934],
  [1753142400000, 196.42381167802614],
  [1753228800000, 205.2909062553001],
  [1753315200000, 189.5923023530127],
  [1753401600000, 182.56084286755046],
  [1753488000000, 186.17182549934944],
  [1753574400000, 184.9395837508933],
  [1753660800000, 188.5758287219798],
  [1753747200000, 183.03025266261037],
  [1753833600000, 181.16776459533068],
  [1753920000000, 177.8780960276323],
  [1754006400000, 172.1630467364299],
  [1754092800000, 162.79127248081605],
  [1754179200000, 158.53125175932496],
  [1754265600000, 161.90312387611363],
  [1754352000000, 169.41522028427192],
  [1754438400000, 164.08356857308905],
  [1754524800000, 168.1731958529984],
  [1754611200000, 175.3851480311338],
  [1754697600000, 176.79535226118225],
  [1754784000000, 180.38638312645054],
  [1754870400000, 182.9089507475702]
];

console.log('🚀 Extending Solana dataset with CoinGecko data...');
console.log(`Adding ${newDataPoints.length} new data points from Jan 12, 2025 to Aug 11, 2025`);

try {
  // Read the existing Solana data
  const dataPath = path.join(__dirname, '..', 'src', 'data', 'sol-historical-data.json');
  const existingData = JSON.parse(fs.readFileSync(dataPath, 'utf8'));
  
  console.log(`Current data: ${existingData.prices.length} data points`);
  console.log(`Period: ${existingData.metadata.period}`);
  
  // Remove the duplicate first entry (we already have 1735689600000 in the existing data)
  const filteredNewData = newDataPoints.slice(1);
  console.log(`Filtered to ${filteredNewData.length} unique new data points`);
  
  // Merge the data
  const mergedPrices = [...existingData.prices, ...filteredNewData];
  
  // Update metadata
  const updatedData = {
    ...existingData,
    metadata: {
      ...existingData.metadata,
      period: "2021-2025",
      data_points: mergedPrices.length,
      to_timestamp: 1754870400,
      note: `Extended Solana dataset from March 2021 through August 2025 - comprehensive coverage with ${mergedPrices.length} data points from CoinGecko MCP API`,
      extended_at: new Date().toISOString(),
      extension_info: "Added 212 data points from January 12, 2025 to August 11, 2025 using CoinGecko MCP API"
    },
    prices: mergedPrices
  };
  
  // Write the updated data
  fs.writeFileSync(dataPath, JSON.stringify(updatedData, null, 2));
  
  console.log('✅ Extension completed successfully!');
  console.log(`Final dataset: ${updatedData.prices.length} data points`);
  console.log(`Coverage: March 1, 2021 to August 11, 2025`);
  console.log(`First price: $${updatedData.prices[0][1].toFixed(2)}`);
  console.log(`Latest price: $${updatedData.prices[updatedData.prices.length-1][1].toFixed(2)}`);
  
  // Verify date ranges
  const firstDate = new Date(updatedData.prices[0][0]).toISOString().split('T')[0];
  const lastDate = new Date(updatedData.prices[updatedData.prices.length-1][0]).toISOString().split('T')[0];
  console.log(`Date range: ${firstDate} to ${lastDate}`);
  
} catch (error) {
  console.error('❌ Error extending Solana data:', error.message);
  process.exit(1);
}
